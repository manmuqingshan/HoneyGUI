# Pixso XML 导出插件

这是一个为 Pixso 设计的插件，旨在通过将设计稿转换为特定的 XML 格式并导出所有相关的图片资源，来简化设计师和开发者的工作流程。

该插件基于 Pixso 官方的 Vue 模板构建，通过解析图层的位置、尺寸、文本样式和图片填充等属性，自动生成适用于自定义 UI 框架的、结构良好的 XML 代码。

## 主要功能

1.  **XML 生成**: 从任何选定的图层（通常是一个顶层画板）创建结构化的 XML 字符串。
2.  **资源发现**: 自动扫描所选图层层级中的所有图片填充图层，并将其添加到导出队列中。
3.  **图片导出**: 一键将所有发现的图片导出为单个 `.zip` 文件。
4.  **组件解析**: 正确处理组件实例，并解析其子图层。
5.  **文本处理**: 提取文本内容、字体、字号和颜色属性。
6.  **特殊关键字处理**: 对名称包含特殊关键字（如 `list`）的嵌套画板应用自定义逻辑，生成独特的 XML 标签（如 `<LIST>`），并采用专门的资源收集策略。

## 开发环境配置

### 前置条件

1.  **Node.js**: 项目构建脚本所必需。我们推荐使用最新的 [Node.js](https://nodejs.org/zh-cn) LTS 版本。

2.  **Pixso 桌面客户端**: 该插件只能在 Pixso 桌面应用程序中加载，但支持网页端测试。

### 安装与构建

1.  **安装依赖**
    进入项目目录后，运行以下命令来安装 `package.json` 文件中列出的所有必需依赖项。
    ```bash
    npm install
    ```
    这将在项目下创建一个 `node_modules` 文件夹，其中包含所有必要的包。

2.  **构建插件**
    此命令将生成一个包含已编译插件文件的、可用于开发的 `main.js`：
    ```bash
    npm run build
    ```
    每次修改相关文件（`main.ts`, `app.vue`）后，都需要重新构建，重新生成了 `main.js` 文件即可。
    或者使用下面命令启动Pixso热更新监听，修改文件并保存后就会自动build：
    ```bash
    npm run dev
    ```

### 在 Pixso 中加载插件

1.  打开 Pixso 桌面客户端。
2.  通过主菜单右上方导航至：`插件` > `开发插件` > `点击上传插件`。
3.  在打开的文件对话框中，导航到您的项目目录并选择 `manifest.json` 文件。
4.  导入成功后，该插件将出现在 `插件` > `开发插件` 菜单下，随时可以运行和测试。

## 用户指南

请按照以下步骤使用插件导出您的设计。

### 步骤 1: 打开插件

在 Pixso 应用中，通过导航至 `插件` > `开发插件` > `D2XML` > `运行`来打开插件。

### 步骤 2: 选择主图层

在您的画板上，选择您希望导出的所有顶层画板（Frame）。插件需要一个选区才能工作。这个画板通常代表一个完整的屏幕或一个完整的 UI 视图。

### 步骤 3: 生成 XML

-   点击插件面板中的 **“生成 XML”** 按钮。
-   插件将处理您的选区，并在文本区域显示生成的 XML 代码。
-   一个通知将会弹出，告知您在所选图层中发现了多少张图片。

### 步骤 4: 导出图片和xml文件

-   生成 XML 后，如果发现了任何图片，**“导出”** 按钮将变为可用状态。
-   点击该按钮，它会将xml文件和所有发现的图片打包成一个 `.zip` 文件，并由您的浏览器下载。
-   **注意**: 您必须先运行“生成 XML”来发现图片，然后才能导出它们。

### 步骤 5: 分割xml文件供HoneyGUI使用

-   将压缩包中的 `design.xml` 复制到 `tool/D2XML/spilt_xml/` 路径中。
-   双击运行同目录下的 `split_xml.bat` 脚本文件得到多个 xml 文件，将这些文件复制到HoneyGUI工程文件夹中，一般是 `root/root_image/


## 核心概念：特殊关键字处理

为了支持像列表和网格这样的动态布局，插件使用了一套基于图层命名的规则系统，当图层名称包含特定关键字时会激活。

### 触发条件

为创建MasterGo不支持的控件，当一个嵌套的画板（即位于另一个画板内部的画板）的名称**包含**以下任一关键字（不区分大小写）时，将触发此特殊逻辑：
-   `cellular`
-   `list`
-   `video`

**重要提示**: 此规则**不适用于**您在画板上最初选择的顶层画板。

### 处理效果

如果一个名为 `my_contact_list` 的嵌套画板被处理，会发生以下情况：

1.  **XML 标签被更改**: 在输出的 XML 中，该画板将被转换为与关键字匹配的标签，而不是通用的 `<WIN>`。
2.  **子节点不被渲染为 XML**: `my_contact_list` 内部的所有图层都不会被转换为 XML 元素。
3.  **专门的图片收集**: 插件仍然会搜索 `my_contact_list` 画板内部以查找图片。但是，如果它遇到一个后代图层的名称**完全等于**某个关键字（例如，一个精确命名为 `list` 的图层），那么该图层及其整个子树将被跳过。

